<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üí° Ôº¥Ôº•Ôº£Ôº®Ôº¢Ôº¨ÔºØÔºØÔº≠ üå± </title>
  <style>
    :root {
      --accent: #2b8a3e;
      --card: #ffffffee
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial
    }

    body {
      margin: 0;
      background: url("/static/images/new2.jpg") no-repeat center center;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    .card {
      background: var(--card);
      max-width: 720px;
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(12, 20, 10, 0.3);
      padding: 28px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      color: var(--accent)
    }

    .lang-switch button {
      margin-left: 8px;
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #dcdcdc;
      background: #fff;
      cursor: pointer
    }

    .lang-switch button.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent)
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px
    }

    .full {
      grid-column: 1/-1
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #333
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 6px
    }

    input[type=text],
    input[type=tel],
    select {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px
    }

    .mic-btn {
      padding: 8px 10px;
      border-radius: 50%;
      border: none;
      background: #eee;
      cursor: pointer
    }

    .mic-btn.active {
      background: var(--accent);
      color: #fff
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer
    }

    button.ghost {
      background: #fff;
      border: 1px solid #bbb;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer
    }

    .note {
      font-size: 13px;
      color: #444;
      margin-top: 8px
    }

    #responseBox {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      font-size: 14px
    }

    @media (max-width:600px) {
      body {
        padding: 12px;
      }

      form {
        grid-template-columns: 1fr
      }
    }
  </style>
</head>

<body>
  <div class="card" role="main">
    <header>
      <h1 id="title">Agriculture Login</h1>
      <div class="lang-switch" role="tablist" aria-label="Language switch">
        <button id="btn-en" class="active" type="button" data-lang="en">EN</button>
        <button id="btn-ml" type="button" data-lang="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
      </div>
    </header>

    <form id="farmForm" autocomplete="on">
      <div>
        <label for="farmerName" id="labelName">Farmer Name</label>
        <div class="input-group">
          <input type="text" id="farmerName" name="farmerName" placeholder="e.g. K. Ram" required />
          <button type="button" class="mic-btn" data-target="farmerName">üé§</button>
        </div>
      </div>

      <div>
        <label for="phone" id="labelPhone">Phone Number</label>
        <div class="input-group">
          <input type="tel" id="phone" name="phone" placeholder="e.g. 9876543210" required pattern="[0-9]{10}" />
          <button type="button" class="mic-btn" data-target="phone">üé§</button>
        </div>
      </div>

      <div>
        <label for="state" id="labelState">State</label>
        <input type="text" id="state" name="state" value="Kerala" readonly />
      </div>

      <div>
        <label for="district" id="labelDistrict">District</label>
        <div class="input-group">
          <select id="district" name="district" required>
            <option value="">-- Select District --</option>
            <option>Thiruvananthapuram</option>
            <option>Kollam</option>
            <option>Pathanamthitta</option>
            <option>Alappuzha</option>
            <option>Kottayam</option>
            <option>Idukki</option>
            <option>Ernakulam</option>
            <option>Thrissur</option>
            <option>Palakkad</option>
            <option>Malappuram</option>
            <option>Kozhikode</option>
            <option>Wayanad</option>
            <option>Kannur</option>
            <option>Kasaragod</option>
          </select>
          <button type="button" class="mic-btn" data-target="district">üé§</button>
        </div>
      </div>

      <div>
        <label for="village" id="labelVillage">Village</label>
        <div class="input-group">
          <select id="village" name="village" required>
            <option value="">-- Select Village --</option>
            <option>Chavakkad</option>
            <option>Vatakara</option>
            <option>Perambra</option>
            <option>Mananthavady</option>
            <option>Munnar</option>
            <option>Aluva</option>
            <option>Kodungallur</option>
            <option>Perumbavoor</option>
          </select>
          <button type="button" class="mic-btn" data-target="village">üé§</button>
        </div>
      </div>

      <div class="full">
        <label for="landType" id="labelLand">Type of land</label>
        <div class="input-group">
          <select id="landType" name="landType" required>
            <option value="">-- Select --</option>
            <option value="sandy">Sandy (‡¥Æ‡¥£‡µΩ ‡¥Æ‡¥£‡µç‡¥£‡µç)</option>
            <option value="clay">Clay (‡¥ï‡µç‡¥≤‡µá ‡¥Æ‡¥£‡µç‡¥£‡µç)</option>
            <option value="loamy">Loamy (‡¥≤‡µã‡¥Æ‡¥ø ‡¥Æ‡¥£‡µç‡¥£‡µç)</option>
            <option value="alluvial">Alluvial (‡¥ò‡¥® ‡¥Æ‡¥£‡µç‡¥£‡µç)</option>
            <option value="rocky">Rocky (‡¥™‡¥æ‡¥± ‡¥Æ‡¥£‡µç‡¥£‡µç)</option>
          </select>
          <button type="button" class="mic-btn" data-target="landType">üé§</button>
        </div>
      </div>

      <div class="full">
        <label for="crop">Crop</label>
        <div class="input-group">
          <select id="crop" name="crop" required>
            <option value="">-- Select Crop --</option>
            <option value="paddy">Paddy</option>
            <option value="wheat">Wheat</option>
            <option value="banana">Banana</option>
            <option value="coconut">Coconut</option>
          </select>
          <button type="button" class="mic-btn" data-target="crop">üé§</button>
        </div>
      </div>


      <div class="full actions">
        <button type="button" class="ghost" id="clearBtn">Clear</button>
        <button type="submit" class="primary" id="submitBtn">Login</button>
      </div>

      <p class="full note" id="note">We will use this information to personalise farming tips. No data leaves your
        browser in this demo.</p>
    </form>

    <!-- Response from Flask will show here -->
    <div id="responseBox" style="display:none;"></div>
  </div>

  <script>
    // ---- Translations ----
    const translations = {
      en: {
        title: 'Krishi Sakhi', labelName: 'Farmer Name', labelPhone: 'Phone Number',
        labelState: 'State', labelDistrict: 'District', labelVillage: 'Village',
        labelLand: 'Type of land', submit: 'Login', clear: 'Clear',
        note: 'We will use this information to personalise farming tips. No data leaves your browser in this demo.',
        placeholders: { farmerName: 'e.g. D.jana', phone: 'e.g. 9876543210' },
        summaryTitle: 'Saved details:'
      },
      ml: {
        title: '‡¥ï‡µÉ‡¥∑‡¥ø ‡¥≤‡µã‡¥ó‡¥ø‡µª', labelName: '‡¥ï‡µº‡¥∑‡¥ï‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç', labelPhone: '‡¥´‡µã‡µ∫ ‡¥®‡¥Æ‡µç‡¥™‡µº',
        labelState: '‡¥∏‡¥Ç‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Ç', labelDistrict: '‡¥ú‡¥ø‡¥≤‡µç‡¥≤', labelVillage: '‡¥ó‡µç‡¥∞‡¥æ‡¥Æ‡¥Ç',
        labelLand: '‡¥≠‡µÇ‡¥Æ‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥§‡¥∞‡¥Ç', submit: '‡¥≤‡µã‡¥ó‡¥ø‡µª', clear: '‡¥∏‡¥´‡¥æ‡¥ï‡µç‡¥§‡¥Ç',
        note: '‡¥à ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥â‡¥™‡¥¶‡µá‡¥∑‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡¥≥‡µÜ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥ø‡¥ó‡¥§‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç. ‡¥à ‡¥°‡µÜ‡¥Æ‡µã‡¥Ø‡¥ø‡µΩ ‡¥°‡¥æ‡¥±‡µç‡¥±‡µç ‡¥¨‡µç‡¥∞‡µó‡¥∏‡¥±‡¥ø‡¥®‡µç ‡¥™‡µÅ‡¥±‡¥§‡µç‡¥§‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡¥æ‡¥±‡¥ø‡¥≤‡µç‡¥≤.',
        placeholders: { farmerName: '‡¥â‡¥¶‡¥æ: ‡¥ï‡µÜ. ‡¥∞‡¥æ‡¥Ç', phone: '‡¥â‡¥¶‡¥æ: 9876543210' },
        summaryTitle: '‡¥∏‡¥Ç‡¥∞‡¥ï‡µç‡¥∑‡¥ø‡¥ö‡µç‡¥ö ‡¥µ‡¥ø‡¥∂‡¥¶‡¥æ‡¥Ç‡¥∂‡¥ô‡µç‡¥ô‡µæ:'
      }
    };

    // ---- Elements ----
    const btnEn = document.getElementById('btn-en');
    const btnMl = document.getElementById('btn-ml');
    const langButtons = [btnEn, btnMl];
    const form = document.getElementById('farmForm');
    const clearBtn = document.getElementById('clearBtn');
    const responseBox = document.getElementById("responseBox");

    const elems = {
      title: document.getElementById('title'),
      labelName: document.getElementById('labelName'),
      labelPhone: document.getElementById('labelPhone'),
      labelState: document.getElementById('labelState'),
      labelDistrict: document.getElementById('labelDistrict'),
      labelVillage: document.getElementById('labelVillage'),
      labelLand: document.getElementById('labelLand'),
      submitBtn: document.getElementById('submitBtn'),
      clearBtn: document.getElementById('clearBtn'),
      note: document.getElementById('note'),
      farmerName: document.getElementById('farmerName'),
      phone: document.getElementById('phone'),
      district: document.getElementById('district'),
      village: document.getElementById('village'),
      landType: document.getElementById('landType')
    };

    function applyLang(lang) {
      const t = translations[lang] || translations.en;
      elems.title.innerText = t.title;
      elems.labelName.innerText = t.labelName;
      elems.labelPhone.innerText = t.labelPhone;
      elems.labelState.innerText = t.labelState;
      elems.labelDistrict.innerText = t.labelDistrict;
      elems.labelVillage.innerText = t.labelVillage;
      elems.labelLand.innerText = t.labelLand;
      elems.submitBtn.innerText = t.submit;
      elems.clearBtn.innerText = t.clear;
      elems.note.innerText = t.note;
      elems.farmerName.placeholder = t.placeholders.farmerName;
      elems.phone.placeholder = t.placeholders.phone;
      langButtons.forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
      localStorage.setItem('agri_lang', lang);
    }

    const savedLang = localStorage.getItem('agri_lang') || 'en';
    applyLang(savedLang);
    btnEn.addEventListener('click', () => applyLang('en'));
    btnMl.addEventListener('click', () => applyLang('ml'));
    clearBtn.addEventListener('click', () => { form.reset(); });

    // ---- Submit to Flask ----
    
    form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const data = {
    farmerName: elems.farmerName.value.trim(),
    phone: elems.phone.value.trim(),
    district: elems.district.value,
    village: elems.village.value,
    landType: elems.landType.value,
    crop: document.getElementById("crop").value
  };

  if(!data.farmerName || !data.phone || !data.district || !data.village || !data.landType || !data.crop){
    alert("Please fill all fields.");
    return;
  }

  try {
    const response = await fetch("/save_profile", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const result = await response.json();

    // Redirect to result page with query params
    const params = new URLSearchParams(result).toString();
    window.location.href = `/result?${params}`;

  } catch (error) {
    console.error("Error:", error);
    alert("Something went wrong while saving profile.");
  }
});

  </script>
</body>

</html>