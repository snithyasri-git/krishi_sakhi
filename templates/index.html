<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ЁЯТб я╝┤я╝ея╝гя╝ия╝вя╝мя╝пя╝пя╝н ЁЯМ▒</title>
  <style>
    :root {
      --accent: #2b8a3e;
      --card: #ffffffee
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial
    }

    body {
      margin: 0;
      background: url("/static/images/new2.jpg") no-repeat center center;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    /* Splash screen */
    .splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 1s ease, visibility 1s ease;
    }
    .splash.hidden { opacity: 0; visibility: hidden; }
    .splash img { width: 200px; animation: fadeIn 2s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .card {
      background: var(--card);
      max-width: 800px; /* Increased to accommodate longer text */
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(12, 20, 10, 0.3);
      padding: 28px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    .card.show { opacity: 1; transform: translateY(0); }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      flex-wrap: wrap; /* Allow wrapping on small screens */
      gap: 10px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      color: var(--accent);
      white-space: nowrap;
    }

    .lang-switch {
      display: flex;
      gap: 6px;
    }

    .lang-switch button {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #dcdcdc;
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      min-width: 50px; /* Ensure consistent button size */
    }

    .lang-switch button.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent)
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px; /* Slightly increased gap */
    }

    .full {
      grid-column: 1/-1
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #333;
      min-height: 16px; /* Ensure consistent height */
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 6px
    }

    input[type=text],
    input[type=tel],
    select {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      min-width: 0; /* Allow shrinking */
    }

    /* Specific styling for select elements to handle longer text */
    select {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    select option {
      font-size: 14px;
      padding: 5px;
    }

    .mic-btn {
      padding: 8px 10px;
      border-radius: 50%;
      border: none;
      background: #eee;
      cursor: pointer;
      flex-shrink: 0; /* Prevent mic button from shrinking */
    }

    .mic-btn.active {
      background: var(--accent);
      color: #fff
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    button.ghost {
      background: #fff;
      border: 1px solid #bbb;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    .note {
      font-size: 13px;
      color: #444;
      margin-top: 8px;
      line-height: 1.4;
    }

    #responseBox {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      font-size: 14px
    }

    @media (max-width:700px) {
      body {
        padding: 12px;
      }

      .card {
        padding: 20px;
      }

      form {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .lang-switch {
        align-self: flex-end;
        margin-top: 10px;
      }

      /* Adjust font sizes for better readability on small screens */
      select, input {
        font-size: 16px; /* Prevent zoom on iOS */
      }
    }

    @media (max-width:400px) {
      .lang-switch button {
        padding: 6px 8px;
        font-size: 12px;
        min-width: 45px;
      }
      
      header h1 {
        font-size: 18px;
      }
    }
  </style>
</head>

<body>
  <!-- Splash screen with AI logo -->
  <div class="splash" id="splashScreen">
    <img src="/static/images/hh.jpg" alt="AI Logo Splash" />
  </div>
  
  <!-- Main card -->
  <div class="card" role="main" id="mainCard">
    <header>
      <div style="display: flex; align-items: center; gap: 8px;">
        <img src="/static/images/hh1.jpg" alt="Logo 1" style="height: 48px;" />
        <h1 id="title">Krishi Sakhi</h1>
      </div>

      <div class="lang-switch" role="tablist" aria-label="Language switch">
        <button id="btn-en" class="active" type="button" data-lang="en">EN</button>
        <button id="btn-ml" type="button" data-lang="ml">р┤ор┤▓р┤пр┤╛р┤│р┤В</button>
        <button id="btn-ta" type="button" data-lang="ta">родрооро┐ро┤рпН</button>
      </div>
    </header>

    <form id="farmForm" autocomplete="on">
      <div>
        <label for="farmerName" id="labelName">Farmer Name</label>
        <div class="input-group">
          <input type="text" id="farmerName" name="farmerName" placeholder="e.g. K. Ram" required />
          <button type="button" class="mic-btn" data-target="farmerName">ЁЯОд</button>
        </div>
      </div>

      <div>
        <label for="phone" id="labelPhone">Phone Number</label>
        <div class="input-group">
          <input type="tel" id="phone" name="phone" placeholder="e.g. 9876543210" required pattern="[0-9]{10}" />
          <button type="button" class="mic-btn" data-target="phone">ЁЯОд</button>
        </div>
      </div>

      <div>
        <label for="state" id="labelState">State</label>
        <input type="text" id="state" name="state" value="Kerala" readonly />
      </div>

      <div>
        <label for="district" id="labelDistrict">District</label>
        <div class="input-group">
          <select id="district" name="district" required>
            <option value="">-- Select District --</option>
            <option>Thiruvananthapuram</option>
            <option>Kollam</option>
            <option>Pathanamthitta</option>
            <option>Alappuzha</option>
            <option>Kottayam</option>
            <option>Idukki</option>
            <option>Ernakulam</option>
            <option>Thrissur</option>
            <option>Palakkad</option>
            <option>Malappuram</option>
            <option>Kozhikode</option>
            <option>Wayanad</option>
            <option>Kannur</option>
            <option>Kasaragod</option>
          </select>
          <button type="button" class="mic-btn" data-target="district">ЁЯОд</button>
        </div>
      </div>

      <div>
        <label for="village" id="labelVillage">Village</label>
        <div class="input-group">
          <select id="village" name="village" required>
            <option value="">-- Select Village --</option>
            <option>Chavakkad</option>
            <option>Vatakara</option>
            <option>Perambra</option>
            <option>Mananthavady</option>
            <option>Munnar</option>
            <option>Aluva</option>
            <option>Kodungallur</option>
            <option>Perumbavoor</option>
          </select>
          <button type="button" class="mic-btn" data-target="village">ЁЯОд</button>
        </div>
      </div>

      <div class="full">
        <label for="landType" id="labelLand">Type of land</label>
        <div class="input-group">
          <select id="landType" name="landType" required>
            <option value="">-- Select --</option>
          </select>
          <button type="button" class="mic-btn" data-target="landType">ЁЯОд</button>
        </div>
      </div>

      <div class="full">
        <label for="crop" id="labelCrop">Crop</label>
        <div class="input-group">
          <select id="crop" name="crop" required>
            <option value="">-- Select Crop --</option>
          </select>
          <button type="button" class="mic-btn" data-target="crop">ЁЯОд</button>
        </div>
      </div>

      <div class="full actions">
        <button type="button" class="ghost" id="clearBtn">Clear</button>
        <button type="submit" class="primary" id="submitBtn">Login</button>
      </div>

      <p class="full note" id="note">We will use this information to personalise farming tips. No data leaves your browser in this demo.</p>
    </form>

    <!-- Response from Flask will show here -->
    <div id="responseBox" style="display:none;"></div>
  </div>

  <script>
    // ----- Location & Language Data -----
    const locationData = {
      "Kerala": {
        "Thiruvananthapuram": { "Thiruvananthapuram":["Andoorkonam","Attipra","Ayiroopara","Cheruvakkal"], "Neyyattinkara":["Anavoor","Athiyannur","Kunnukara"] },
        "Ernakulam": { "Aluva":["Chengamanad","Parakkadavu"], "Muvattupuzha":["Arakuzha","Elanji"] }
      },
      "Tamil Nadu": {
        "Chennai": { "Chennai North":["Villivakkam","Anna Nagar"], "Chennai South":["Adyar","Velachery"] },
        "Coimbatore": { "Coimbatore North":["R.S.Puram","Gandhipuram"], "Coimbatore South":["Singanallur","Podanur"] }
      }
    };

    const locationNames = {
      en: {
        "Kerala": "Kerala",
        "Thiruvananthapuram":"Thiruvananthapuram","Neyyattinkara":"Neyyattinkara","Ernakulam":"Ernakulam",
        "Aluva":"Aluva","Muvattupuzha":"Muvattupuzha","Chennai North":"Chennai North","Chennai South":"Chennai South",
        "Coimbatore North":"Coimbatore North","Coimbatore South":"Coimbatore South",
        // Villages English
        "Andoorkonam":"Andoorkonam","Attipra":"Attipra","Ayiroopara":"Ayiroopara","Cheruvakkal":"Cheruvakkal",
        "Anavoor":"Anavoor","Athiyannur":"Athiyannur","Kunnukara":"Kunnukara",
        "Chengamanad":"Chengamanad","Parakkadavu":"Parakkadavu","Arakuzha":"Arakuzha","Elanji":"Elanji",
        "Villivakkam":"Villivakkam","Anna Nagar":"Anna Nagar","Adyar":"Adyar","Velachery":"Velachery",
        "R.S.Puram":"R.S.Puram","Gandhipuram":"Gandhipuram","Singanallur":"Singanallur","Podanur":"Podanur",
        "Chavakkad": "Chavakkad", "Vatakara": "Vatakara", "Perambra": "Perambra", "Mananthavady": "Mananthavady",
        "Munnar": "Munnar", "Aluva": "Aluva", "Kodungallur": "Kodungallur", "Perumbavoor": "Perumbavoor",
        "Kollam": "Kollam", "Pathanamthitta": "Pathanamthitta", "Alappuzha": "Alappuzha", "Kottayam": "Kottayam",
        "Idukki": "Idukki", "Thrissur": "Thrissur", "Palakkad": "Palakkad", "Malappuram": "Malappuram",
        "Kozhikode": "Kozhikode", "Wayanad": "Wayanad", "Kannur": "Kannur", "Kasaragod": "Kasaragod"
      },
      ml: {
        "Kerala": "р┤Хр╡Зр┤░р┤│р┤В",
        "Thiruvananthapuram":"р┤др┤┐р┤░р╡Бр┤╡р┤ир┤ир╡Нр┤др┤кр╡Бр┤░р┤В","Neyyattinkara":"р┤ир╡Жр┤пр╡Нр┤пр┤╛р┤▒р╡Нр┤▒р┤┐р╡╗р┤Хр┤░","Ernakulam":"р┤Ор┤▒р┤гр┤╛р┤Хр╡Бр┤│р┤В",
        "Aluva":"р┤Ер┤▓р╡Бр┤╡","Muvattupuzha":"р┤ор╡Бр┤╡р┤╛р┤▒р╡Нр┤▒р╡Бр┤кр╡Бр┤┤","Chennai North":"р┤Ър╡Жр┤ир╡Нр┤ир╡И р┤ир╡Лр╡╝р┤др╡Нр┤др╡Н","Chennai South":"р┤Ър╡Жр┤ир╡Нр┤ир╡И р┤╕р╡Мр┤др╡Нр┤др╡Н",
        "Coimbatore North":"р┤Хр╡Лр┤пр┤Вр┤мр┤др╡Нр┤др╡Вр╡╝ р┤ир╡Лр╡╝р┤др╡Нр┤др╡Н","Coimbatore South":"р┤Хр╡Лр┤пр┤Вр┤мр┤др╡Нр┤др╡Вр╡╝ р┤╕р╡Мр┤др╡Нр┤др╡Н",
        // Villages Malayalam
        "Andoorkonam":"р┤Жр┤гр╡Нр┤Яр╡Вр╡╝р┤Хр╡Нр┤Хр╡Лр┤гр┤╛р┤В","Attipra":"р┤Ер┤Яр╡Нр┤Яр┤┐р┤кр╡Нр┤░","Ayiroopara":"р┤Ер┤пр┤┐р┤░р╡Вр┤кр┤╛р┤▒","Cheruvakkal":"р┤Ър╡Жр┤▒р╡Бр┤╡р┤Хр╡Нр┤Хр╡╜",
        "Anavoor":"р┤Жр┤ир┤╡р╡Вр╡╝","Athiyannur":"р┤Ер┤др┤┐р┤░р┤┐р┤пр┤ир╡Нр┤ир╡Вр╡╝","Kunnukara":"р┤Хр╡Бр┤ир╡Нр┤ир╡Бр┤Хр┤░",
        "Chengamanad":"р┤Ър╡Жр┤Вр┤Чр┤ор┤ир┤╛р┤Яр╡Н","Parakkadavu":"р┤кр┤░р┤Хр╡Нр┤Хр┤Яр┤╛р┤╡р╡Н","Arakuzha":"р┤Жр┤▒р┤╛р┤Хр╡Нр┤Хр╡Бр┤┤","Elanji":"р┤Зр┤│р┤Юр╡Нр┤Юр┤┐",
        "Villivakkam":"р┤╡р┤┐р┤│р┤┐р┤╡р┤╛р┤Хр╡Нр┤Хр┤В","Anna Nagar":"р┤Ер┤гр╡Нр┤гр┤╛ р┤ир┤Чр╡╝","Adyar":"р┤Ер┤бр╡Нр┤пр┤╛р╡╝","Velachery":"р┤╡р╡Жр┤│р┤Ър╡Нр┤Ър╡Зр┤░р┤┐",
        "R.S.Puram":"р┤Жр╡╝.р┤Ор┤╕р╡Н.р┤кр╡Бр┤░р┤В","Gandhipuram":"р┤Чр┤╛р┤ир╡Нр┤зр┤┐р┤кр╡Бр┤░р┤В","Singanallur":"р┤╕р┤┐р┤Вр┤Чр┤╛р┤ир┤▓р╡Нр┤▓р╡Вр╡╝","Podanur":"р┤кр╡Лр┤бр┤ир╡Вр╡╝",
        "Chavakkad": "р┤Ър┤╛р┤╡р┤Хр╡Нр┤Хр┤╛р┤Яр╡Н", "Vatakara": "р┤╡р┤Яр┤Хр┤░", "Perambra": "р┤кр╡Зр┤░р┤╛р┤ор╡Нр┤кр╡Нр┤░", "Mananthavady": "р┤ор┤гр┤ир╡Нр┤др┤╡р┤╛р┤Яр┤┐",
        "Munnar": "р┤ор╡Вр┤ир╡Нр┤ир┤╛р╡╝", "Aluva": "р┤Ер┤▓р╡Бр┤╡", "Kodungallur": "р┤Хр╡Кр┤Яр╡Бр┤Щр╡Нр┤Щр┤▓р╡Нр┤▓р╡Вр╡╝", "Perumbavoor": "р┤кр╡Жр┤░р╡Бр┤ор╡Нр┤кр┤╛р┤╡р╡Вр╡╝",
        "Kollam": "р┤Хр╡Кр┤▓р╡Нр┤▓р┤В", "Pathanamthitta": "р┤кр┤др╡Нр┤др┤ир┤Вр┤др┤┐р┤Яр╡Нр┤Я", "Alappuzha": "р┤Жр┤▓р┤кр╡Нр┤кр╡Бр┤┤", "Kottayam": "р┤Хр╡Лр┤Яр╡Нр┤Яр┤пр┤В",
        "Idukki": "р┤Зр┤Яр╡Бр┤Хр╡Нр┤Хр┤┐", "Thrissur": "р┤др╡Гр┤╢р╡Нр┤╢р╡Вр╡╝", "Palakkad": "р┤кр┤╛р┤▓р┤Хр╡Нр┤Хр┤╛р┤Яр╡Н", "Malappuram": "р┤ор┤▓р┤кр╡Нр┤кр╡Бр┤▒р┤В",
        "Kozhikode": "р┤Хр╡Лр┤┤р┤┐р┤Хр╡Нр┤Хр╡Лр┤Яр╡Н", "Wayanad": "р┤╡р┤пр┤ир┤╛р┤Яр╡Н", "Kannur": "р┤Хр┤гр╡Нр┤гр╡Вр╡╝", "Kasaragod": "р┤Хр┤╛р┤╕р╡╝р┤Чр╡Лр┤бр╡Н"
      },
      ta: {
        "Kerala": "роХрпЗро░ро│ро╛",
        "Thiruvananthapuram":"родро┐ро░рпБро╡ройроирпНродрокрпБро░роорпН","Neyyattinkara":"роирпЖропрпНропро╛роЯрпНроЯро┐роЩрпНроХро░ро╛","Ernakulam":"роОро░рпНрогро╛роХрпБро│роорпН",
        "Aluva":"роЕро▓рпБро╡ро╛","Muvattupuzha":"роорпБро╡роЯрпНроЯрпБрокрпНрокрпБро┤ро╛","Chennai North":"роЪрпЖройрпНройрпИ ро╡роЯроХрпНроХрпБ","Chennai South":"роЪрпЖройрпНройрпИ родрпЖро▒рпНроХрпБ",
        "Coimbatore North":"роХрпЛропроорпНрокрпБродрпНродрпВро░рпН ро╡роЯроХрпНроХрпБ","Coimbatore South":"роХрпЛропроорпНрокрпБродрпНродрпВро░рпН родрпЖро▒рпНроХрпБ",
        // Villages Tamil
        "Andoorkonam":"роЕрогрпНроЯрпВро░рпНроХрпЛрогроорпН","Attipra":"роЕроЯрпНроЯро┐рокрпНро░ро╛","Ayiroopara":"роЕропро┐ро░рпВрокро╛ро░ро╛","Cheruvakkal":"роЪрпЖро░рпБро╡роХрпНроХро▓рпН",
        "Anavoor":"роЕройро╡рпВро░рпН","Athiyannur":"роЕродро┐ропройрпНройрпВро░рпН","Kunnukara":"роХрпБройрпНройрпБроХро╛ро░ро╛",
        "Chengamanad":"роЪрпЖроЩрпНроХроорогро╛роЯрпН","Parakkadavu":"рокро░роХрпНроХроЯро╡рпБ","Arakuzha":"роЕро░ро╛роХрпБро┤ро╛","Elanji":"роОро▓роЮрпНроЪро┐",
        "Villivakkam":"ро╡ро┐ро▓рпНро▓ро┐ро╡ро╛роХрпНроХроорпН","Anna Nagar":"роЕрогрпНрогро╛ роироХро░рпН","Adyar":"роЕроЯрпИропро╛ро░рпН","Velachery":"ро╡рпЖро│роЪрпНроЪрпЗро░ро┐",
        "R.S.Puram":"роЖро░рпН.роОро╕рпН.рокрпБро░роорпН","Gandhipuram":"роХро╛роирпНродро┐рокрпБро░роорпН","Singanallur":"роЪро┐роЩрпНроХро╛ройро▓рпНро▓рпВро░рпН","Podanur":"рокрпЛроЯройрпВро░рпН",
        "Chavakkad": "роЪро╛ро╡роХрпНроХро╛роЯрпБ", "Vatakara": "ро╡роЯроХро░рпИ", "Perambra": "рокрпЗро░ро╛роорпНрокро▒рпИ", "Mananthavady": "роорогроирпНродро╡ро╛роЯро┐",
        "Munnar": "роорпВрогро╛ро░рпН", "Aluva": "роЕро▓рпБро╡ро╛", "Kodungallur": "роХрпКроЯрпБроЩрпНроХро▓рпНро▓рпВро░рпН", "Perumbavoor": "рокрпЖро░рпБроорпНрокро╛ро╡рпВро░рпН",
        "Kollam": "роХрпКро▓рпНро▓роорпН", "Pathanamthitta": "рокродрпНродройроирпНродро┐роЯрпНроЯрпИ", "Alappuzha": "роЖро▓рокрпНрокрпБро┤рпИ", "Kottayam": "роХрпЛроЯрпНроЯропроорпН",
        "Idukki": "роЗроЯрпБроХрпНроХро┐", "Thrissur": "родро┐ро░рпБроЪрпНроЪрпВро░рпН", "Palakkad": "рокро╛ро▓роХрпНроХро╛роЯрпБ", "Malappuram": "рооро▓рокрпНрокрпБро▒роорпН",
        "Kozhikode": "роХрпЛро┤ро┐роХрпНроХрпЛроЯрпБ", "Wayanad": "ро╡ропроиро╛роЯрпБ", "Kannur": "роХрогрпНрогрпВро░рпН", "Kasaragod": "роХро╛роЪро░рпНроХрпЛроЯрпБ"
      }
    };

    const translations = {
      en: { 
        title: 'Krishi Sakhi', 
        labelName: 'Farmer Name', 
        labelPhone: 'Phone Number',
        labelState: 'State', 
        labelDistrict: 'District', 
        labelVillage: 'Village',
        labelLand: 'Type of land', 
        labelCrop: 'Crop',
        submit: 'Login', 
        clear: 'Clear',
        note: 'We will use this information to personalise farming tips. No data leaves your browser in this demo.',
        placeholders: { farmerName: 'e.g. K. Ram', phone: 'e.g. 9876543210' },
        selectDistrict: '-- Select District --',
        selectVillage: '-- Select Village --',
        selectLandType: '-- Select --',
        selectCrop: '-- Select Crop --',
        landTypes: ["Sandy","Clay","Loamy","Alluvial","Rocky"],
        crops: ["Paddy", "Wheat", "Banana", "Coconut"]
      },
      ml: { 
        title: 'р┤Хр╡Гр┤╖р┤┐ р┤╕р┤Цр┤┐', 
        labelName: 'р┤Хр╡╝р┤╖р┤Хр┤ир╡Нр┤▒р╡Ж р┤кр╡Зр┤░р╡Н', 
        labelPhone: 'р┤лр╡Лр╡║ р┤ир┤ор╡Нр┤кр╡╝',
        labelState: 'р┤╕р┤Вр┤╕р╡Нр┤ер┤╛р┤ир┤В', 
        labelDistrict: 'р┤Ьр┤┐р┤▓р╡Нр┤▓', 
        labelVillage: 'р┤Чр╡Нр┤░р┤╛р┤ор┤В',
        labelLand: 'р┤нр╡Вр┤ор┤┐р┤пр╡Бр┤Яр╡Ж р┤др┤░р┤В', 
        labelCrop: 'р┤╡р┤┐р┤│',
        submit: 'р┤▓р╡Лр┤Чр┤┐р╡╗', 
        clear: 'р┤╕р┤лр┤╛р┤Хр╡Нр┤др┤В',
        note: 'р┤И р┤╡р┤┐р┤╡р┤░р┤Щр╡Нр┤Щр╡╛ р┤Хр╡Гр┤╖р┤┐ р┤Йр┤кр┤жр╡Зр┤╖р╡Нр┤Яр┤╛р┤Хр╡Нр┤Хр┤│р╡Ж р┤╡р╡Нр┤пр┤Хр╡Нр┤др┤┐р┤Чр┤др┤ор┤╛р┤Хр╡Нр┤Хр┤╛р╡╗ р┤Йр┤кр┤пр╡Лр┤Чр┤┐р┤Хр╡Нр┤Хр╡Бр┤В. р┤бр┤╛р┤▒р╡Нр┤▒ р┤мр╡Нр┤░р╡Чр┤╕р┤▒р┤┐р┤ир╡Н р┤кр╡Бр┤▒р┤др╡Нр┤др╡Зр┤Хр╡Нр┤Хр╡Н р┤кр╡Лр┤Хр╡Бр┤ир╡Нр┤ир┤┐р┤▓р╡Нр┤▓.',
        placeholders: { farmerName: 'р┤Йр┤жр┤╛: р┤Хр╡Ж. р┤░р┤╛р┤В', phone: 'р┤Йр┤жр┤╛: 9876543210' },
        selectDistrict: '-- р┤Ьр┤┐р┤▓р╡Нр┤▓ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х --',
        selectVillage: '-- р┤Чр╡Нр┤░р┤╛р┤ор┤В р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х --',
        selectLandType: '-- р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х --',
        selectCrop: '-- р┤╡р┤┐р┤│ р┤др┤┐р┤░р┤Юр╡Нр┤Юр╡Жр┤Яр╡Бр┤Хр╡Нр┤Хр╡Бр┤Х --',
        landTypes: ["р┤ор┤гр╡╜","р┤Хр┤┐р┤│р╡╝","р┤▓р╡Лр┤ор┤┐","р┤Ер┤▓р╡Вр┤╡р┤┐р┤пр╡╜","р┤кр┤╛р┤▒"],
        crops: ["р┤ир╡Жр┤▓р╡Нр┤▓р╡Н", "р┤Чр╡Лр┤др┤ор╡Нр┤кр╡Н", "р┤╡р┤╛р┤┤", "р┤др╡Жр┤Щр╡Нр┤Щр╡Н"]
      },
      ta: { 
        title: 'роХро┐ро░рпБро╖ро┐ роЪроХро┐', 
        labelName: 'ро╡ро┐ро╡роЪро╛ропро┐ропро┐ройрпН рокрпЖропро░рпН', 
        labelPhone: 'родрпКро▓рпИрокрпЗроЪро┐ роОрогрпН',
        labelState: 'рооро╛роиро┐ро▓роорпН', 
        labelDistrict: 'рооро╛ро╡роЯрпНроЯроорпН', 
        labelVillage: 'роХро┐ро░ро╛роороорпН',
        labelLand: 'роорогрпНрогро┐ройрпН ро╡роХрпИ', 
        labelCrop: 'рокропро┐ро░рпН',
        submit: 'рокродро┐ро╡рпБ', 
        clear: 'роЕро┤ро┐',
        note: 'роЗроирпНрод родроХро╡ро▓рпНроХро│рпН ро╡ро┐ро╡роЪро╛роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпИ родройро┐рокрпНрокропройро╛роХрпНроХ рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯрпБроорпН. роОроирпНрод родро░ро╡рпБроорпН роЙро▓ро╛ро╡ро┐ропрпИ ро╡ро┐роЯрпНроЯрпБ ро╡рпЖро│ро┐ропрпЗ рокрпЛроХро╡ро┐ро▓рпНро▓рпИ.',
        placeholders: { farmerName: 'роЙродро╛: роХрпЗ. ро░ро╛роорпН', phone: 'роЙродро╛: 9876543210' },
        selectDistrict: '-- рооро╛ро╡роЯрпНроЯродрпНродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --',
        selectVillage: '-- роХро┐ро░ро╛роородрпНродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --',
        selectLandType: '-- родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --',
        selectCrop: '-- рокропро┐ро░рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН --',
        landTypes: ["роорогро▓рпН","роХро│ро┐роорогрпН","ро▓рпЛрооро┐","роЕро▓рпВро╡ро┐ропро▓рпН","рокро╛ро▒рпИ"],
        crops: ["роирпЖро▓рпН", "роХрпЛродрпБроорпИ", "ро╡ро╛ро┤рпИ", "родрпЗроЩрпНроХро╛ропрпН"]
      }
    };

    const elems = {
      title: document.getElementById('title'),
      labelName: document.getElementById('labelName'),
      labelPhone: document.getElementById('labelPhone'),
      labelState: document.getElementById('labelState'),
      labelDistrict: document.getElementById('labelDistrict'),
      labelVillage: document.getElementById('labelVillage'),
      labelLand: document.getElementById('labelLand'),
      labelCrop: document.getElementById('labelCrop'),
      submitBtn: document.getElementById('submitBtn'),
      clearBtn: document.getElementById('clearBtn'),
      note: document.getElementById('note'),
      farmerName: document.getElementById('farmerName'),
      phone: document.getElementById('phone'),
      state: document.getElementById('state'),
      district: document.getElementById('district'),
      village: document.getElementById('village'),
      landType: document.getElementById('landType'),
      crop: document.getElementById('crop')
    };

    // Function to populate districts
    function populateDistricts(lang) {
      const districtSelect = elems.district;
      const currentValue = districtSelect.value;
      
      // Clear existing options except the first one
      districtSelect.innerHTML = `<option value="">${translations[lang].selectDistrict}</option>`;
      
      // Add districts for Kerala
      const districts = [
        "Thiruvananthapuram", "Kollam", "Pathanamthitta", "Alappuzha", 
        "Kottayam", "Idukki", "Ernakulam", "Thrissur", 
        "Palakkad", "Malappuram", "Kozhikode", "Wayanad", 
        "Kannur", "Kasaragod"
      ];
      
      districts.forEach(district => {
        const option = document.createElement("option");
        option.value = district;
        option.textContent = locationNames[lang][district] || district;
        districtSelect.appendChild(option);
      });
      
      // Restore previously selected value if it exists
      if (currentValue && districts.includes(currentValue)) {
        districtSelect.value = currentValue;
      }
    }

    // Function to populate villages
    function populateVillages(lang) {
      const villageSelect = elems.village;
      const currentValue = villageSelect.value;
      const selectedDistrict = elems.district.value;
      
      // Clear existing options except the first one
      villageSelect.innerHTML = `<option value="">${translations[lang].selectVillage}</option>`;
      
      // Add villages based on selected district
      const villages = [
        "Chavakkad", "Vatakara", "Perambra", "Mananthavady", 
        "Munnar", "Aluva", "Kodungallur", "Perumbavoor"
      ];
      
      villages.forEach(village => {
        const option = document.createElement("option");
        option.value = village;
        option.textContent = locationNames[lang][village] || village;
        villageSelect.appendChild(option);
      });
      
      // Restore previously selected value if it exists
      if (currentValue && villages.includes(currentValue)) {
        villageSelect.value = currentValue;
      }
    }

    function populateLandTypes(lang){
      elems.landType.innerHTML=`<option value="">${translations[lang].selectLandType}</option>`;
      translations[lang].landTypes.forEach((l,i)=>{
        const opt=document.createElement("option");
        opt.value=["sandy","clay","loamy","alluvial","rocky"][i];
        opt.textContent=l;
        elems.landType.appendChild(opt);
      });
    }

    function populateCrops(lang){
      elems.crop.innerHTML=`<option value="">${translations[lang].selectCrop}</option>`;
      translations[lang].crops.forEach((c,i)=>{
        const opt=document.createElement("option");
        opt.value=["paddy","wheat","banana","coconut"][i];
        opt.textContent=c;
        elems.crop.appendChild(opt);
      });
    }

    function applyLang(lang){
      const t=translations[lang];
      elems.title.innerText=t.title;
      elems.labelName.innerText=t.labelName;
      elems.labelPhone.innerText=t.labelPhone;
      elems.labelState.innerText=t.labelState;
      elems.labelDistrict.innerText=t.labelDistrict;
      elems.labelVillage.innerText=t.labelVillage;
      elems.labelLand.innerText=t.labelLand;
      elems.labelCrop.innerText=t.labelCrop;
      elems.submitBtn.innerText=t.submit;
      elems.clearBtn.innerText=t.clear;
      elems.note.innerText=t.note;
      elems.farmerName.placeholder=t.placeholders.farmerName;
      elems.phone.placeholder=t.placeholders.phone;
      
      // Update state name
      elems.state.value = locationNames[lang]["Kerala"] || "Kerala";
      
      // Update all dropdowns
      populateDistricts(lang);
      populateVillages(lang);
      populateLandTypes(lang);
      populateCrops(lang);
      
      localStorage.setItem('agri_lang',lang);
      document.querySelectorAll('.lang-switch button').forEach(b=>b.classList.toggle('active',b.dataset.lang===lang));
    }

    // Language switching
    const savedLang = localStorage.getItem('agri_lang')||'en';
    applyLang(savedLang);

    document.getElementById('btn-en').onclick=()=>applyLang('en');
    document.getElementById('btn-ml').onclick=()=>applyLang('ml');
    document.getElementById('btn-ta').onclick=()=>applyLang('ta');

    // Update villages when district changes
    elems.district.addEventListener('change', () => {
      const lang = localStorage.getItem('agri_lang') || 'en';
      populateVillages(lang);
    });

    // ----- MIC BUTTON FUNCTIONALITY -----
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SpeechRecognition){
      const recognizer = new SpeechRecognition();
      recognizer.interimResults = false;

      document.querySelectorAll('.mic-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const targetId = btn.dataset.target;
          const inputElem = document.getElementById(targetId);
          btn.classList.add('active');

          // Update language dynamically
          const langCode = localStorage.getItem('agri_lang') || 'en';
          recognizer.lang = langCode==='ml' ? 'ml-IN' : langCode==='ta' ? 'ta-IN' : 'en-US';

          recognizer.abort(); // stop any previous session
          recognizer.start();

          recognizer.onresult = (event)=>{
            const transcript = event.results[0][0].transcript;
            inputElem.value = transcript;
          };

          recognizer.onend = ()=>{ btn.classList.remove('active'); };
        });
      });
    } else {
      console.warn("Speech Recognition not supported in this browser.");
    }

    // Clear form
    elems.clearBtn.addEventListener('click', ()=>{
      document.getElementById('farmForm').reset();
      const lang=localStorage.getItem('agri_lang')||'en';
      populateDistricts(lang);
      populateVillages(lang);
      populateLandTypes(lang);
      populateCrops(lang);
    });

    // Splash screen hide
    window.addEventListener('load', ()=>{
      const splash = document.getElementById('splashScreen');
      const card = document.getElementById('mainCard');
      setTimeout(()=>{
        splash.classList.add('hidden');
        card.classList.add('show');
      },1500);
    });

    // ---- Submit to Flask ----
    document.getElementById('farmForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = {
        farmerName: elems.farmerName.value.trim(),
        phone: elems.phone.value.trim(),
        district: elems.district.value,
        village: elems.village.value,
        landType: elems.landType.value,
        crop: elems.crop.value
      };

      if(!data.farmerName || !data.phone || !data.district || !data.village || !data.landType || !data.crop){
        alert("Please fill all fields.");
        return;
      }

      try {
        const response = await fetch("/save_profile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await response.json();

        // Redirect to result page with query params
        const params = new URLSearchParams(result).toString();
        window.location.href = `/result?${params}`;

      } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong while saving profile.");
      }
    });
  </script>
</body>
</html>