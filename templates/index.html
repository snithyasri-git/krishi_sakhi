<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üí° Ôº¥Ôº•Ôº£Ôº®Ôº¢Ôº¨ÔºØÔºØÔº≠ üå±</title>
  <style>
    :root {
      --accent: #2b8a3e;
      --card: #ffffffee
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial
    }

    body {
      margin: 0;
      background: url("/static/images/new2.jpg") no-repeat center center;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 24px;
    }

    /* Splash screen */
    .splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: white;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      transition: opacity 1s ease, visibility 1s ease;
    }
    .splash.hidden { opacity: 0; visibility: hidden; }
    .splash img { width: 200px; animation: fadeIn 2s ease; }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    .card {
      background: var(--card);
      max-width: 800px; /* Increased to accommodate longer text */
      width: 100%;
      border-radius: 12px;
      box-shadow: 0 8px 30px rgba(12, 20, 10, 0.3);
      padding: 28px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    .card.show { opacity: 1; transform: translateY(0); }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
      flex-wrap: wrap; /* Allow wrapping on small screens */
      gap: 10px;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      color: var(--accent);
      white-space: nowrap;
    }

    .lang-switch {
      display: flex;
      gap: 6px;
    }

    .lang-switch button {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #dcdcdc;
      background: #fff;
      cursor: pointer;
      font-size: 13px;
      min-width: 50px; /* Ensure consistent button size */
    }

    .lang-switch button.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent)
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px; /* Slightly increased gap */
    }

    .full {
      grid-column: 1/-1
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
      color: #333;
      min-height: 16px; /* Ensure consistent height */
    }

    .input-group {
      display: flex;
      align-items: center;
      gap: 6px
    }

    input[type=text],
    input[type=tel],
    select {
      flex: 1;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      min-width: 0; /* Allow shrinking */
    }

    /* Specific styling for select elements to handle longer text */
    select {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    select option {
      font-size: 14px;
      padding: 5px;
    }

    .mic-btn {
      padding: 8px 10px;
      border-radius: 50%;
      border: none;
      background: #eee;
      cursor: pointer;
      flex-shrink: 0; /* Prevent mic button from shrinking */
    }

    .mic-btn.active {
      background: var(--accent);
      color: #fff
    }

    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 14px
    }

    button.primary {
      background: var(--accent);
      color: #fff;
      border: 0;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    button.ghost {
      background: #fff;
      border: 1px solid #bbb;
      padding: 10px 14px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
    }

    .note {
      font-size: 13px;
      color: #444;
      margin-top: 8px;
      line-height: 1.4;
    }

    #responseBox {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      font-size: 14px
    }

    @media (max-width:700px) {
      body {
        padding: 12px;
      }

      .card {
        padding: 20px;
      }

      form {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .lang-switch {
        align-self: flex-end;
        margin-top: 10px;
      }

      /* Adjust font sizes for better readability on small screens */
      select, input {
        font-size: 16px; /* Prevent zoom on iOS */
      }
    }

    @media (max-width:400px) {
      .lang-switch button {
        padding: 6px 8px;
        font-size: 12px;
        min-width: 45px;
      }
      
      header h1 {
        font-size: 18px;
      }
    }
  </style>
</head>

<body>
  <!-- Splash screen with AI logo -->
  <div class="splash" id="splashScreen">
    <img src="/static/images/hh.jpg" alt="AI Logo Splash" />
  </div>
  
  <!-- Main card -->
  <div class="card" role="main" id="mainCard">
    <header>
      <div style="display: flex; align-items: center; gap: 8px;">
        <img src="/static/images/hh1.jpg" alt="Logo 1" style="height: 48px;" />
        <h1 id="title">Krishi Sakhi</h1>
      </div>

      <div class="lang-switch" role="tablist" aria-label="Language switch">
        <button id="btn-en" class="active" type="button" data-lang="en">EN</button>
        <button id="btn-ml" type="button" data-lang="ml">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç</button>
        <button id="btn-ta" type="button" data-lang="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</button>
      </div>
    </header>

    <form id="farmForm" autocomplete="on">
      <div>
        <label for="farmerName" id="labelName">Farmer Name</label>
        <div class="input-group">
          <input type="text" id="farmerName" name="farmerName" placeholder="e.g. K. Ram" required />
          <button type="button" class="mic-btn" data-target="farmerName">üé§</button>
        </div>
      </div>

      <div>
        <label for="phone" id="labelPhone">Phone Number</label>
        <div class="input-group">
          <input type="tel" id="phone" name="phone" placeholder="e.g. 9876543210" required pattern="[0-9]{10}" />
          <button type="button" class="mic-btn" data-target="phone">üé§</button>
        </div>
      </div>

      <div>
        <label for="state" id="labelState">State</label>
        <input type="text" id="state" name="state" value="Kerala" readonly />
      </div>

      <div>
        <label for="district" id="labelDistrict">District</label>
        <div class="input-group">
          <select id="district" name="district" required>
            <option value="">-- Select District --</option>
            <option>Thiruvananthapuram</option>
            <option>Kollam</option>
            <option>Pathanamthitta</option>
            <option>Alappuzha</option>
            <option>Kottayam</option>
            <option>Idukki</option>
            <option>Ernakulam</option>
            <option>Thrissur</option>
            <option>Palakkad</option>
            <option>Malappuram</option>
            <option>Kozhikode</option>
            <option>Wayanad</option>
            <option>Kannur</option>
            <option>Kasaragod</option>
          </select>
          <button type="button" class="mic-btn" data-target="district">üé§</button>
        </div>
      </div>

      <div>
        <label for="village" id="labelVillage">Village</label>
        <div class="input-group">
          <select id="village" name="village" required>
            <option value="">-- Select Village --</option>
            <option>Chavakkad</option>
            <option>Vatakara</option>
            <option>Perambra</option>
            <option>Mananthavady</option>
            <option>Munnar</option>
            <option>Aluva</option>
            <option>Kodungallur</option>
            <option>Perumbavoor</option>
          </select>
          <button type="button" class="mic-btn" data-target="village">üé§</button>
        </div>
      </div>

      <div class="full">
        <label for="landType" id="labelLand">Type of land</label>
        <div class="input-group">
          <select id="landType" name="landType" required>
            <option value="">-- Select --</option>
          </select>
          <button type="button" class="mic-btn" data-target="landType">üé§</button>
        </div>
      </div>

      <div class="full">
        <label for="crop" id="labelCrop">Crop</label>
        <div class="input-group">
          <select id="crop" name="crop" required>
            <option value="">-- Select Crop --</option>
          </select>
          <button type="button" class="mic-btn" data-target="crop">üé§</button>
        </div>
      </div>

      <div class="full actions">
        <button type="button" class="ghost" id="clearBtn">Clear</button>
        <button type="submit" class="primary" id="submitBtn">Login</button>
      </div>

      <p class="full note" id="note">We will use this information to personalise farming tips. No data leaves your browser in this demo.</p>
    </form>

    <!-- Response from Flask will show here -->
    <div id="responseBox" style="display:none;"></div>
  </div>

  <script>
    // ----- Location & Language Data -----
    const locationData = {
      "Kerala": {
        "Thiruvananthapuram": { "Thiruvananthapuram":["Andoorkonam","Attipra","Ayiroopara","Cheruvakkal"], "Neyyattinkara":["Anavoor","Athiyannur","Kunnukara"] },
        "Ernakulam": { "Aluva":["Chengamanad","Parakkadavu"], "Muvattupuzha":["Arakuzha","Elanji"] }
      },
      "Tamil Nadu": {
        "Chennai": { "Chennai North":["Villivakkam","Anna Nagar"], "Chennai South":["Adyar","Velachery"] },
        "Coimbatore": { "Coimbatore North":["R.S.Puram","Gandhipuram"], "Coimbatore South":["Singanallur","Podanur"] }
      }
    };

    const locationNames = {
      en: {
        "Kerala": "Kerala",
        "Thiruvananthapuram":"Thiruvananthapuram","Neyyattinkara":"Neyyattinkara","Ernakulam":"Ernakulam",
        "Aluva":"Aluva","Muvattupuzha":"Muvattupuzha","Chennai North":"Chennai North","Chennai South":"Chennai South",
        "Coimbatore North":"Coimbatore North","Coimbatore South":"Coimbatore South",
        // Villages English
        "Andoorkonam":"Andoorkonam","Attipra":"Attipra","Ayiroopara":"Ayiroopara","Cheruvakkal":"Cheruvakkal",
        "Anavoor":"Anavoor","Athiyannur":"Athiyannur","Kunnukara":"Kunnukara",
        "Chengamanad":"Chengamanad","Parakkadavu":"Parakkadavu","Arakuzha":"Arakuzha","Elanji":"Elanji",
        "Villivakkam":"Villivakkam","Anna Nagar":"Anna Nagar","Adyar":"Adyar","Velachery":"Velachery",
        "R.S.Puram":"R.S.Puram","Gandhipuram":"Gandhipuram","Singanallur":"Singanallur","Podanur":"Podanur",
        "Chavakkad": "Chavakkad", "Vatakara": "Vatakara", "Perambra": "Perambra", "Mananthavady": "Mananthavady",
        "Munnar": "Munnar", "Aluva": "Aluva", "Kodungallur": "Kodungallur", "Perumbavoor": "Perumbavoor",
        "Kollam": "Kollam", "Pathanamthitta": "Pathanamthitta", "Alappuzha": "Alappuzha", "Kottayam": "Kottayam",
        "Idukki": "Idukki", "Thrissur": "Thrissur", "Palakkad": "Palakkad", "Malappuram": "Malappuram",
        "Kozhikode": "Kozhikode", "Wayanad": "Wayanad", "Kannur": "Kannur", "Kasaragod": "Kasaragod"
      },
      ml: {
        "Kerala": "‡¥ï‡µá‡¥∞‡¥≥‡¥Ç",
        "Thiruvananthapuram":"‡¥§‡¥ø‡¥∞‡µÅ‡¥µ‡¥®‡¥®‡µç‡¥§‡¥™‡µÅ‡¥∞‡¥Ç","Neyyattinkara":"‡¥®‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥±‡µç‡¥±‡¥ø‡µª‡¥ï‡¥∞","Ernakulam":"‡¥é‡¥±‡¥£‡¥æ‡¥ï‡µÅ‡¥≥‡¥Ç",
        "Aluva":"‡¥Ö‡¥≤‡µÅ‡¥µ","Muvattupuzha":"‡¥Æ‡µÅ‡¥µ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥™‡µÅ‡¥¥","Chennai North":"‡¥ö‡µÜ‡¥®‡µç‡¥®‡µà ‡¥®‡µã‡µº‡¥§‡µç‡¥§‡µç","Chennai South":"‡¥ö‡µÜ‡¥®‡µç‡¥®‡µà ‡¥∏‡µå‡¥§‡µç‡¥§‡µç",
        "Coimbatore North":"‡¥ï‡µã‡¥Ø‡¥Ç‡¥¨‡¥§‡µç‡¥§‡µÇ‡µº ‡¥®‡µã‡µº‡¥§‡µç‡¥§‡µç","Coimbatore South":"‡¥ï‡µã‡¥Ø‡¥Ç‡¥¨‡¥§‡µç‡¥§‡µÇ‡µº ‡¥∏‡µå‡¥§‡µç‡¥§‡µç",
        // Villages Malayalam
        "Andoorkonam":"‡¥Ü‡¥£‡µç‡¥ü‡µÇ‡µº‡¥ï‡µç‡¥ï‡µã‡¥£‡¥æ‡¥Ç","Attipra":"‡¥Ö‡¥ü‡µç‡¥ü‡¥ø‡¥™‡µç‡¥∞","Ayiroopara":"‡¥Ö‡¥Ø‡¥ø‡¥∞‡µÇ‡¥™‡¥æ‡¥±","Cheruvakkal":"‡¥ö‡µÜ‡¥±‡µÅ‡¥µ‡¥ï‡µç‡¥ï‡µΩ",
        "Anavoor":"‡¥Ü‡¥®‡¥µ‡µÇ‡µº","Athiyannur":"‡¥Ö‡¥§‡¥ø‡¥∞‡¥ø‡¥Ø‡¥®‡µç‡¥®‡µÇ‡µº","Kunnukara":"‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ‡¥ï‡¥∞",
        "Chengamanad":"‡¥ö‡µÜ‡¥Ç‡¥ó‡¥Æ‡¥®‡¥æ‡¥ü‡µç","Parakkadavu":"‡¥™‡¥∞‡¥ï‡µç‡¥ï‡¥ü‡¥æ‡¥µ‡µç","Arakuzha":"‡¥Ü‡¥±‡¥æ‡¥ï‡µç‡¥ï‡µÅ‡¥¥","Elanji":"‡¥á‡¥≥‡¥û‡µç‡¥û‡¥ø",
        "Villivakkam":"‡¥µ‡¥ø‡¥≥‡¥ø‡¥µ‡¥æ‡¥ï‡µç‡¥ï‡¥Ç","Anna Nagar":"‡¥Ö‡¥£‡µç‡¥£‡¥æ ‡¥®‡¥ó‡µº","Adyar":"‡¥Ö‡¥°‡µç‡¥Ø‡¥æ‡µº","Velachery":"‡¥µ‡µÜ‡¥≥‡¥ö‡µç‡¥ö‡µá‡¥∞‡¥ø",
        "R.S.Puram":"‡¥Ü‡µº.‡¥é‡¥∏‡µç.‡¥™‡µÅ‡¥∞‡¥Ç","Gandhipuram":"‡¥ó‡¥æ‡¥®‡µç‡¥ß‡¥ø‡¥™‡µÅ‡¥∞‡¥Ç","Singanallur":"‡¥∏‡¥ø‡¥Ç‡¥ó‡¥æ‡¥®‡¥≤‡µç‡¥≤‡µÇ‡µº","Podanur":"‡¥™‡µã‡¥°‡¥®‡µÇ‡µº",
        "Chavakkad": "‡¥ö‡¥æ‡¥µ‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç", "Vatakara": "‡¥µ‡¥ü‡¥ï‡¥∞", "Perambra": "‡¥™‡µá‡¥∞‡¥æ‡¥Æ‡µç‡¥™‡µç‡¥∞", "Mananthavady": "‡¥Æ‡¥£‡¥®‡µç‡¥§‡¥µ‡¥æ‡¥ü‡¥ø",
        "Munnar": "‡¥Æ‡µÇ‡¥®‡µç‡¥®‡¥æ‡µº", "Aluva": "‡¥Ö‡¥≤‡µÅ‡¥µ", "Kodungallur": "‡¥ï‡µä‡¥ü‡µÅ‡¥ô‡µç‡¥ô‡¥≤‡µç‡¥≤‡µÇ‡µº", "Perumbavoor": "‡¥™‡µÜ‡¥∞‡µÅ‡¥Æ‡µç‡¥™‡¥æ‡¥µ‡µÇ‡µº",
        "Kollam": "‡¥ï‡µä‡¥≤‡µç‡¥≤‡¥Ç", "Pathanamthitta": "‡¥™‡¥§‡µç‡¥§‡¥®‡¥Ç‡¥§‡¥ø‡¥ü‡µç‡¥ü", "Alappuzha": "‡¥Ü‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥¥", "Kottayam": "‡¥ï‡µã‡¥ü‡µç‡¥ü‡¥Ø‡¥Ç",
        "Idukki": "‡¥á‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡¥ø", "Thrissur": "‡¥§‡µÉ‡¥∂‡µç‡¥∂‡µÇ‡µº", "Palakkad": "‡¥™‡¥æ‡¥≤‡¥ï‡µç‡¥ï‡¥æ‡¥ü‡µç", "Malappuram": "‡¥Æ‡¥≤‡¥™‡µç‡¥™‡µÅ‡¥±‡¥Ç",
        "Kozhikode": "‡¥ï‡µã‡¥¥‡¥ø‡¥ï‡µç‡¥ï‡µã‡¥ü‡µç", "Wayanad": "‡¥µ‡¥Ø‡¥®‡¥æ‡¥ü‡µç", "Kannur": "‡¥ï‡¥£‡µç‡¥£‡µÇ‡µº", "Kasaragod": "‡¥ï‡¥æ‡¥∏‡µº‡¥ó‡µã‡¥°‡µç"
      },
      ta: {
        "Kerala": "‡Æï‡Øá‡Æ∞‡Æ≥‡Ææ",
        "Thiruvananthapuram":"‡Æ§‡Æø‡Æ∞‡ØÅ‡Æµ‡Æ©‡Æ®‡Øç‡Æ§‡Æ™‡ØÅ‡Æ∞‡ÆÆ‡Øç","Neyyattinkara":"‡Æ®‡ØÜ‡ÆØ‡Øç‡ÆØ‡Ææ‡Æü‡Øç‡Æü‡Æø‡Æô‡Øç‡Æï‡Æ∞‡Ææ","Ernakulam":"‡Æé‡Æ∞‡Øç‡Æ£‡Ææ‡Æï‡ØÅ‡Æ≥‡ÆÆ‡Øç",
        "Aluva":"‡ÆÖ‡Æ≤‡ØÅ‡Æµ‡Ææ","Muvattupuzha":"‡ÆÆ‡ØÅ‡Æµ‡Æü‡Øç‡Æü‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ‡Æ¥‡Ææ","Chennai North":"‡Æö‡ØÜ‡Æ©‡Øç‡Æ©‡Øà ‡Æµ‡Æü‡Æï‡Øç‡Æï‡ØÅ","Chennai South":"‡Æö‡ØÜ‡Æ©‡Øç‡Æ©‡Øà ‡Æ§‡ØÜ‡Æ±‡Øç‡Æï‡ØÅ",
        "Coimbatore North":"‡Æï‡Øã‡ÆØ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æ§‡Øç‡Æ§‡ØÇ‡Æ∞‡Øç ‡Æµ‡Æü‡Æï‡Øç‡Æï‡ØÅ","Coimbatore South":"‡Æï‡Øã‡ÆØ‡ÆÆ‡Øç‡Æ™‡ØÅ‡Æ§‡Øç‡Æ§‡ØÇ‡Æ∞‡Øç ‡Æ§‡ØÜ‡Æ±‡Øç‡Æï‡ØÅ",
        // Villages Tamil
        "Andoorkonam":"‡ÆÖ‡Æ£‡Øç‡Æü‡ØÇ‡Æ∞‡Øç‡Æï‡Øã‡Æ£‡ÆÆ‡Øç","Attipra":"‡ÆÖ‡Æü‡Øç‡Æü‡Æø‡Æ™‡Øç‡Æ∞‡Ææ","Ayiroopara":"‡ÆÖ‡ÆØ‡Æø‡Æ∞‡ØÇ‡Æ™‡Ææ‡Æ∞‡Ææ","Cheruvakkal":"‡Æö‡ØÜ‡Æ∞‡ØÅ‡Æµ‡Æï‡Øç‡Æï‡Æ≤‡Øç",
        "Anavoor":"‡ÆÖ‡Æ©‡Æµ‡ØÇ‡Æ∞‡Øç","Athiyannur":"‡ÆÖ‡Æ§‡Æø‡ÆØ‡Æ©‡Øç‡Æ©‡ØÇ‡Æ∞‡Øç","Kunnukara":"‡Æï‡ØÅ‡Æ©‡Øç‡Æ©‡ØÅ‡Æï‡Ææ‡Æ∞‡Ææ",
        "Chengamanad":"‡Æö‡ØÜ‡Æô‡Øç‡Æï‡ÆÆ‡Æ£‡Ææ‡Æü‡Øç","Parakkadavu":"‡Æ™‡Æ∞‡Æï‡Øç‡Æï‡Æü‡Æµ‡ØÅ","Arakuzha":"‡ÆÖ‡Æ∞‡Ææ‡Æï‡ØÅ‡Æ¥‡Ææ","Elanji":"‡Æé‡Æ≤‡Æû‡Øç‡Æö‡Æø",
        "Villivakkam":"‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Æø‡Æµ‡Ææ‡Æï‡Øç‡Æï‡ÆÆ‡Øç","Anna Nagar":"‡ÆÖ‡Æ£‡Øç‡Æ£‡Ææ ‡Æ®‡Æï‡Æ∞‡Øç","Adyar":"‡ÆÖ‡Æü‡Øà‡ÆØ‡Ææ‡Æ∞‡Øç","Velachery":"‡Æµ‡ØÜ‡Æ≥‡Æö‡Øç‡Æö‡Øá‡Æ∞‡Æø",
        "R.S.Puram":"‡ÆÜ‡Æ∞‡Øç.‡Æé‡Æ∏‡Øç.‡Æ™‡ØÅ‡Æ∞‡ÆÆ‡Øç","Gandhipuram":"‡Æï‡Ææ‡Æ®‡Øç‡Æ§‡Æø‡Æ™‡ØÅ‡Æ∞‡ÆÆ‡Øç","Singanallur":"‡Æö‡Æø‡Æô‡Øç‡Æï‡Ææ‡Æ©‡Æ≤‡Øç‡Æ≤‡ØÇ‡Æ∞‡Øç","Podanur":"‡Æ™‡Øã‡Æü‡Æ©‡ØÇ‡Æ∞‡Øç",
        "Chavakkad": "‡Æö‡Ææ‡Æµ‡Æï‡Øç‡Æï‡Ææ‡Æü‡ØÅ", "Vatakara": "‡Æµ‡Æü‡Æï‡Æ∞‡Øà", "Perambra": "‡Æ™‡Øá‡Æ∞‡Ææ‡ÆÆ‡Øç‡Æ™‡Æ±‡Øà", "Mananthavady": "‡ÆÆ‡Æ£‡Æ®‡Øç‡Æ§‡Æµ‡Ææ‡Æü‡Æø",
        "Munnar": "‡ÆÆ‡ØÇ‡Æ£‡Ææ‡Æ∞‡Øç", "Aluva": "‡ÆÖ‡Æ≤‡ØÅ‡Æµ‡Ææ", "Kodungallur": "‡Æï‡Øä‡Æü‡ØÅ‡Æô‡Øç‡Æï‡Æ≤‡Øç‡Æ≤‡ØÇ‡Æ∞‡Øç", "Perumbavoor": "‡Æ™‡ØÜ‡Æ∞‡ØÅ‡ÆÆ‡Øç‡Æ™‡Ææ‡Æµ‡ØÇ‡Æ∞‡Øç",
        "Kollam": "‡Æï‡Øä‡Æ≤‡Øç‡Æ≤‡ÆÆ‡Øç", "Pathanamthitta": "‡Æ™‡Æ§‡Øç‡Æ§‡Æ©‡Æ®‡Øç‡Æ§‡Æø‡Æü‡Øç‡Æü‡Øà", "Alappuzha": "‡ÆÜ‡Æ≤‡Æ™‡Øç‡Æ™‡ØÅ‡Æ¥‡Øà", "Kottayam": "‡Æï‡Øã‡Æü‡Øç‡Æü‡ÆØ‡ÆÆ‡Øç",
        "Idukki": "‡Æá‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æø", "Thrissur": "‡Æ§‡Æø‡Æ∞‡ØÅ‡Æö‡Øç‡Æö‡ØÇ‡Æ∞‡Øç", "Palakkad": "‡Æ™‡Ææ‡Æ≤‡Æï‡Øç‡Æï‡Ææ‡Æü‡ØÅ", "Malappuram": "‡ÆÆ‡Æ≤‡Æ™‡Øç‡Æ™‡ØÅ‡Æ±‡ÆÆ‡Øç",
        "Kozhikode": "‡Æï‡Øã‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Øã‡Æü‡ØÅ", "Wayanad": "‡Æµ‡ÆØ‡Æ®‡Ææ‡Æü‡ØÅ", "Kannur": "‡Æï‡Æ£‡Øç‡Æ£‡ØÇ‡Æ∞‡Øç", "Kasaragod": "‡Æï‡Ææ‡Æö‡Æ∞‡Øç‡Æï‡Øã‡Æü‡ØÅ"
      }
    };

    const translations = {
      en: { 
        title: 'Krishi Sakhi', 
        labelName: 'Farmer Name', 
        labelPhone: 'Phone Number',
        labelState: 'State', 
        labelDistrict: 'District', 
        labelVillage: 'Village',
        labelLand: 'Type of land', 
        labelCrop: 'Crop',
        submit: 'Login', 
        clear: 'Clear',
        note: 'We will use this information to personalise farming tips. No data leaves your browser in this demo.',
        placeholders: { farmerName: 'e.g. K. Ram', phone: 'e.g. 9876543210' },
        selectDistrict: '-- Select District --',
        selectVillage: '-- Select Village --',
        selectLandType: '-- Select --',
        selectCrop: '-- Select Crop --',
        landTypes: ["Sandy","Clay","Loamy","Alluvial","Rocky"],
        crops: ["Paddy", "Wheat", "Banana", "Coconut"]
      },
      ml: { 
        title: '‡¥ï‡µÉ‡¥∑‡¥ø ‡¥∏‡¥ñ‡¥ø', 
        labelName: '‡¥ï‡µº‡¥∑‡¥ï‡¥®‡µç‡¥±‡µÜ ‡¥™‡µá‡¥∞‡µç', 
        labelPhone: '‡¥´‡µã‡µ∫ ‡¥®‡¥Æ‡µç‡¥™‡µº',
        labelState: '‡¥∏‡¥Ç‡¥∏‡µç‡¥•‡¥æ‡¥®‡¥Ç', 
        labelDistrict: '‡¥ú‡¥ø‡¥≤‡µç‡¥≤', 
        labelVillage: '‡¥ó‡µç‡¥∞‡¥æ‡¥Æ‡¥Ç',
        labelLand: '‡¥≠‡µÇ‡¥Æ‡¥ø‡¥Ø‡µÅ‡¥ü‡µÜ ‡¥§‡¥∞‡¥Ç', 
        labelCrop: '‡¥µ‡¥ø‡¥≥',
        submit: '‡¥≤‡µã‡¥ó‡¥ø‡µª', 
        clear: '‡¥∏‡¥´‡¥æ‡¥ï‡µç‡¥§‡¥Ç',
        note: '‡¥à ‡¥µ‡¥ø‡¥µ‡¥∞‡¥ô‡µç‡¥ô‡µæ ‡¥ï‡µÉ‡¥∑‡¥ø ‡¥â‡¥™‡¥¶‡µá‡¥∑‡µç‡¥ü‡¥æ‡¥ï‡µç‡¥ï‡¥≥‡µÜ ‡¥µ‡µç‡¥Ø‡¥ï‡µç‡¥§‡¥ø‡¥ó‡¥§‡¥Æ‡¥æ‡¥ï‡µç‡¥ï‡¥æ‡µª ‡¥â‡¥™‡¥Ø‡µã‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Ç. ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥¨‡µç‡¥∞‡µó‡¥∏‡¥±‡¥ø‡¥®‡µç ‡¥™‡µÅ‡¥±‡¥§‡µç‡¥§‡µá‡¥ï‡µç‡¥ï‡µç ‡¥™‡µã‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤.',
        placeholders: { farmerName: '‡¥â‡¥¶‡¥æ: ‡¥ï‡µÜ. ‡¥∞‡¥æ‡¥Ç', phone: '‡¥â‡¥¶‡¥æ: 9876543210' },
        selectDistrict: '-- ‡¥ú‡¥ø‡¥≤‡µç‡¥≤ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï --',
        selectVillage: '-- ‡¥ó‡µç‡¥∞‡¥æ‡¥Æ‡¥Ç ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï --',
        selectLandType: '-- ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï --',
        selectCrop: '-- ‡¥µ‡¥ø‡¥≥ ‡¥§‡¥ø‡¥∞‡¥û‡µç‡¥û‡µÜ‡¥ü‡µÅ‡¥ï‡µç‡¥ï‡µÅ‡¥ï --',
        landTypes: ["‡¥Æ‡¥£‡µΩ","‡¥ï‡¥ø‡¥≥‡µº","‡¥≤‡µã‡¥Æ‡¥ø","‡¥Ö‡¥≤‡µÇ‡¥µ‡¥ø‡¥Ø‡µΩ","‡¥™‡¥æ‡¥±"],
        crops: ["‡¥®‡µÜ‡¥≤‡µç‡¥≤‡µç", "‡¥ó‡µã‡¥§‡¥Æ‡µç‡¥™‡µç", "‡¥µ‡¥æ‡¥¥", "‡¥§‡µÜ‡¥ô‡µç‡¥ô‡µç"]
      },
      ta: { 
        title: '‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Æø ‡Æö‡Æï‡Æø', 
        labelName: '‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡Æø‡ÆØ‡Æø‡Æ©‡Øç ‡Æ™‡ØÜ‡ÆØ‡Æ∞‡Øç', 
        labelPhone: '‡Æ§‡Øä‡Æ≤‡Øà‡Æ™‡Øá‡Æö‡Æø ‡Æé‡Æ£‡Øç',
        labelState: '‡ÆÆ‡Ææ‡Æ®‡Æø‡Æ≤‡ÆÆ‡Øç', 
        labelDistrict: '‡ÆÆ‡Ææ‡Æµ‡Æü‡Øç‡Æü‡ÆÆ‡Øç', 
        labelVillage: '‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡ÆÆ‡Øç',
        labelLand: '‡ÆÆ‡Æ£‡Øç‡Æ£‡Æø‡Æ©‡Øç ‡Æµ‡Æï‡Øà', 
        labelCrop: '‡Æ™‡ÆØ‡Æø‡Æ∞‡Øç',
        submit: '‡Æ™‡Æ§‡Æø‡Æµ‡ØÅ', 
        clear: '‡ÆÖ‡Æ¥‡Æø',
        note: '‡Æá‡Æ®‡Øç‡Æ§ ‡Æ§‡Æï‡Æµ‡Æ≤‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øà ‡Æ§‡Æ©‡Æø‡Æ™‡Øç‡Æ™‡ÆØ‡Æ©‡Ææ‡Æï‡Øç‡Æï ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡ÆÆ‡Øç. ‡Æé‡Æ®‡Øç‡Æ§ ‡Æ§‡Æ∞‡Æµ‡ØÅ‡ÆÆ‡Øç ‡Æâ‡Æ≤‡Ææ‡Æµ‡Æø‡ÆØ‡Øà ‡Æµ‡Æø‡Æü‡Øç‡Æü‡ØÅ ‡Æµ‡ØÜ‡Æ≥‡Æø‡ÆØ‡Øá ‡Æ™‡Øã‡Æï‡Æµ‡Æø‡Æ≤‡Øç‡Æ≤‡Øà.',
        placeholders: { farmerName: '‡Æâ‡Æ§‡Ææ: ‡Æï‡Øá. ‡Æ∞‡Ææ‡ÆÆ‡Øç', phone: '‡Æâ‡Æ§‡Ææ: 9876543210' },
        selectDistrict: '-- ‡ÆÆ‡Ææ‡Æµ‡Æü‡Øç‡Æü‡Æ§‡Øç‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --',
        selectVillage: '-- ‡Æï‡Æø‡Æ∞‡Ææ‡ÆÆ‡Æ§‡Øç‡Æ§‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --',
        selectLandType: '-- ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --',
        selectCrop: '-- ‡Æ™‡ÆØ‡Æø‡Æ∞‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç --',
        landTypes: ["‡ÆÆ‡Æ£‡Æ≤‡Øç","‡Æï‡Æ≥‡Æø‡ÆÆ‡Æ£‡Øç","‡Æ≤‡Øã‡ÆÆ‡Æø","‡ÆÖ‡Æ≤‡ØÇ‡Æµ‡Æø‡ÆØ‡Æ≤‡Øç","‡Æ™‡Ææ‡Æ±‡Øà"],
        crops: ["‡Æ®‡ØÜ‡Æ≤‡Øç", "‡Æï‡Øã‡Æ§‡ØÅ‡ÆÆ‡Øà", "‡Æµ‡Ææ‡Æ¥‡Øà", "‡Æ§‡Øá‡Æô‡Øç‡Æï‡Ææ‡ÆØ‡Øç"]
      }
    };

    const elems = {
      title: document.getElementById('title'),
      labelName: document.getElementById('labelName'),
      labelPhone: document.getElementById('labelPhone'),
      labelState: document.getElementById('labelState'),
      labelDistrict: document.getElementById('labelDistrict'),
      labelVillage: document.getElementById('labelVillage'),
      labelLand: document.getElementById('labelLand'),
      labelCrop: document.getElementById('labelCrop'),
      submitBtn: document.getElementById('submitBtn'),
      clearBtn: document.getElementById('clearBtn'),
      note: document.getElementById('note'),
      farmerName: document.getElementById('farmerName'),
      phone: document.getElementById('phone'),
      state: document.getElementById('state'),
      district: document.getElementById('district'),
      village: document.getElementById('village'),
      landType: document.getElementById('landType'),
      crop: document.getElementById('crop')
    };

    // Function to populate districts
    function populateDistricts(lang) {
      const districtSelect = elems.district;
      const currentValue = districtSelect.value;
      
      // Clear existing options except the first one
      districtSelect.innerHTML = `<option value="">${translations[lang].selectDistrict}</option>`;
      
      // Add districts for Kerala
      const districts = [
        "Thiruvananthapuram", "Kollam", "Pathanamthitta", "Alappuzha", 
        "Kottayam", "Idukki", "Ernakulam", "Thrissur", 
        "Palakkad", "Malappuram", "Kozhikode", "Wayanad", 
        "Kannur", "Kasaragod"
      ];
      
      districts.forEach(district => {
        const option = document.createElement("option");
        option.value = district;
        option.textContent = locationNames[lang][district] || district;
        districtSelect.appendChild(option);
      });
      
      // Restore previously selected value if it exists
      if (currentValue && districts.includes(currentValue)) {
        districtSelect.value = currentValue;
      }
    }

    // Function to populate villages
    function populateVillages(lang) {
      const villageSelect = elems.village;
      const currentValue = villageSelect.value;
      const selectedDistrict = elems.district.value;
      
      // Clear existing options except the first one
      villageSelect.innerHTML = `<option value="">${translations[lang].selectVillage}</option>`;
      
      // Add villages based on selected district
      const villages = [
        "Chavakkad", "Vatakara", "Perambra", "Mananthavady", 
        "Munnar", "Aluva", "Kodungallur", "Perumbavoor"
      ];
      
      villages.forEach(village => {
        const option = document.createElement("option");
        option.value = village;
        option.textContent = locationNames[lang][village] || village;
        villageSelect.appendChild(option);
      });
      
      // Restore previously selected value if it exists
      if (currentValue && villages.includes(currentValue)) {
        villageSelect.value = currentValue;
      }
    }

    function populateLandTypes(lang){
      elems.landType.innerHTML=`<option value="">${translations[lang].selectLandType}</option>`;
      translations[lang].landTypes.forEach((l,i)=>{
        const opt=document.createElement("option");
        opt.value=["sandy","clay","loamy","alluvial","rocky"][i];
        opt.textContent=l;
        elems.landType.appendChild(opt);
      });
    }

    function populateCrops(lang){
      elems.crop.innerHTML=`<option value="">${translations[lang].selectCrop}</option>`;
      translations[lang].crops.forEach((c,i)=>{
        const opt=document.createElement("option");
        opt.value=["paddy","wheat","banana","coconut"][i];
        opt.textContent=c;
        elems.crop.appendChild(opt);
      });
    }

    function applyLang(lang){
      const t=translations[lang];
      elems.title.innerText=t.title;
      elems.labelName.innerText=t.labelName;
      elems.labelPhone.innerText=t.labelPhone;
      elems.labelState.innerText=t.labelState;
      elems.labelDistrict.innerText=t.labelDistrict;
      elems.labelVillage.innerText=t.labelVillage;
      elems.labelLand.innerText=t.labelLand;
      elems.labelCrop.innerText=t.labelCrop;
      elems.submitBtn.innerText=t.submit;
      elems.clearBtn.innerText=t.clear;
      elems.note.innerText=t.note;
      elems.farmerName.placeholder=t.placeholders.farmerName;
      elems.phone.placeholder=t.placeholders.phone;
      
      // Update state name
      elems.state.value = locationNames[lang]["Kerala"] || "Kerala";
      
      // Update all dropdowns
      populateDistricts(lang);
      populateVillages(lang);
      populateLandTypes(lang);
      populateCrops(lang);
      
      localStorage.setItem('agri_lang',lang);
      document.querySelectorAll('.lang-switch button').forEach(b=>b.classList.toggle('active',b.dataset.lang===lang));
    }

    // Language switching
    const savedLang = localStorage.getItem('agri_lang')||'en';
    applyLang(savedLang);

    document.getElementById('btn-en').onclick=()=>applyLang('en');
    document.getElementById('btn-ml').onclick=()=>applyLang('ml');
    document.getElementById('btn-ta').onclick=()=>applyLang('ta');

    // Update villages when district changes
    elems.district.addEventListener('change', () => {
      const lang = localStorage.getItem('agri_lang') || 'en';
      populateVillages(lang);
    });

    // ----- MIC BUTTON FUNCTIONALITY -----
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if(SpeechRecognition){
      const recognizer = new SpeechRecognition();
      recognizer.interimResults = false;

      document.querySelectorAll('.mic-btn').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const targetId = btn.dataset.target;
          const inputElem = document.getElementById(targetId);
          btn.classList.add('active');

          // Update language dynamically
          const langCode = localStorage.getItem('agri_lang') || 'en';
          recognizer.lang = langCode==='ml' ? 'ml-IN' : langCode==='ta' ? 'ta-IN' : 'en-US';

          recognizer.abort(); // stop any previous session
          recognizer.start();

          recognizer.onresult = (event)=>{
            const transcript = event.results[0][0].transcript;
            inputElem.value = transcript;
          };

          recognizer.onend = ()=>{ btn.classList.remove('active'); };
        });
      });
    } else {
      console.warn("Speech Recognition not supported in this browser.");
    }

    // Clear form
    elems.clearBtn.addEventListener('click', ()=>{
      document.getElementById('farmForm').reset();
      const lang=localStorage.getItem('agri_lang')||'en';
      populateDistricts(lang);
      populateVillages(lang);
      populateLandTypes(lang);
      populateCrops(lang);
    });

    // Splash screen hide
    window.addEventListener('load', ()=>{
      const splash = document.getElementById('splashScreen');
      const card = document.getElementById('mainCard');
      setTimeout(()=>{
        splash.classList.add('hidden');
        card.classList.add('show');
      },1500);
    });

    // ---- Submit to Flask ----
    document.getElementById('farmForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const data = {
        farmerName: elems.farmerName.value.trim(),
        phone: elems.phone.value.trim(),
        district: elems.district.value,
        village: elems.village.value,
        landType: elems.landType.value,
        crop: elems.crop.value
      };

      if(!data.farmerName || !data.phone || !data.district || !data.village || !data.landType || !data.crop){
        alert("Please fill all fields.");
        return;
      }

      try {
        const response = await fetch("/save_profile", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
        const result = await response.json();

        // Redirect to result page with query params
        const params = new URLSearchParams(result).toString();
        window.location.href = `/result?${params}`;

      } catch (error) {
        console.error("Error:", error);
        alert("Something went wrong while saving profile.");
      }
    });
  </script>
</body>
</html>